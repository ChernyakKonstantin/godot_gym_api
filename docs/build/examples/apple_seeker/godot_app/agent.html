<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating Agent &mdash; Godot Gym API 1.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=91e4a3f0"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../_static/tabs.js?v=3030b3cb"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Creating Environment" href="environment.html" />
    <link rel="prev" title="Creating World" href="world.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Godot Gym API
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../godot/index.html">Godot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../godobuf/index.html">Godobuf</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Apple Seeker example</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#environment-description">Environment Description</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#steps">Steps</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../project.html">Project Creating</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../message_proto.html">Creating protobuf message</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Creating Godot Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../gym_env.html">Creating Gym Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../agent_training.html">Training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../final.html">Final</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Godot Gym API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Apple Seeker example</a></li>
          <li class="breadcrumb-item"><a href="index.html">Creating Godot Application</a></li>
      <li class="breadcrumb-item active">Creating Agent</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/examples/apple_seeker/godot_app/agent.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-agent">
<h1>Creating Agent<a class="headerlink" href="#creating-agent" title="Permalink to this heading"></a></h1>
<p>Now we are going to create an <em>Agent</em>.
In <strong>Godot Gym API</strong> <em>Agent</em> (<code class="docutils literal notranslate"><span class="pre">RLAgent</span></code> node) is assumed stay in the same position,
while its children can move. This done to enable the agent control different node types
(e.g., <code class="docutils literal notranslate"><span class="pre">KinematicBody</span></code> or <code class="docutils literal notranslate"><span class="pre">VehcileBody</span></code>).</p>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">Agent.tscn</span></code> file.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">Agent</span></code> node type from <code class="docutils literal notranslate"><span class="pre">Spatial</span></code> to <code class="docutils literal notranslate"><span class="pre">RLAgent</span></code>.</p></li>
<li><p>Add child node called <strong>Sensors</strong> of <code class="docutils literal notranslate"><span class="pre">Spatial</span></code> type as follow <code class="docutils literal notranslate"><span class="pre">RLAgent/Body/Sensors</span></code>.</p></li>
<li><p>Put 16 <code class="docutils literal notranslate"><span class="pre">RayCast</span></code> nodes as shown on image below to avoid handling collision layer system since rays intersect the robot body itself:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../../_images/locate_sensors.png"><img alt="../../../_images/locate_sensors.png" src="../../../_images/locate_sensors.png" style="width: 600px;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">RayCast</span></code> nodes property <code class="docutils literal notranslate"><span class="pre">cast_to</span></code> should be set as <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">5</span></code>.</p>
</div></blockquote>
</li>
<li><p>Attach the following script to <code class="docutils literal notranslate"><span class="pre">Sensor</span></code> node:</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">extends</span><span class="w"> </span><span class="n">Spatial</span>

<span class="c1"># The maximum distance of the agent sensors.</span>
<span class="k">const</span><span class="w"> </span><span class="n">max_sensor_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="c1"># Target node</span>
<span class="k">var</span><span class="w"> </span><span class="n">target</span>

<span class="k">func</span><span class="w"> </span><span class="n">get_data</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="p">:</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">distances_to_obstacle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">distances_to_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">ray</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">get_children</span><span class="p">():</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">distance</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_sensor_distance</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">distance_to_target</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_sensor_distance</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">ray</span><span class="o">.</span><span class="n">is_colliding</span><span class="p">():</span>
<span class="w">            </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">.</span><span class="n">global_translation</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get_collision_point</span><span class="p">())</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">ray</span><span class="o">.</span><span class="n">get_collider</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">target</span><span class="p">:</span>
<span class="w">                </span><span class="n">distance_to_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span>
<span class="w">        </span><span class="n">distances_to_obstacle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="w">        </span><span class="n">distances_to_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance_to_target</span><span class="p">)</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;distances_to_obstacle&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">distances_to_obstacle</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;distances_to_target&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">distances_to_target</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">data</span>
</pre></div>
</div>
<p>This script gathers data into dictionary with two keys: <code class="docutils literal notranslate"><span class="pre">distances_to_obstacle</span></code> and <code class="docutils literal notranslate"><span class="pre">distances_to_target</span></code>.
Recall, this is what we wanted to use as agent’s observation in previous section.</p>
</div></blockquote>
</li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">Agent</span></code> node script.</p></li>
<li><p>Change script as follows:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TW9kaWZpZWQgc2NyaXB0" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tab" tabindex="0">Modified script</button><button aria-controls="panel-0-T3JpZ2luYWwgc2NyaXB0" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tab" tabindex="-1">Original script</button></div><div aria-labelledby="tab-0-TW9kaWZpZWQgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">extends</span><span class="w"> </span><span class="n">RLAgent</span>

<span class="k">export</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">target_node_path</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">NodePath</span>

<span class="c1"># How fast the agent moves in meters per second.</span>
<span class="k">var</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="c1"># Current velocity of the agent.</span>
<span class="k">var</span><span class="w"> </span><span class="n">velocity</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="k">var</span><span class="w"> </span><span class="n">current_action</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">onready</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">Body</span>
<span class="k">onready</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">sensors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">Sensors</span>

<span class="k">func</span><span class="w"> </span><span class="n">get_data</span><span class="p">(</span><span class="n">_observation_request</span><span class="p">,</span><span class="w"> </span><span class="n">storage</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="p">:</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensors</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;distances_to_obstacle&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="n">storage</span><span class="o">.</span><span class="n">add_distances_to_obstacle</span><span class="p">(</span><span class="nb nb-Type">float</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;distances_to_target&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="n">storage</span><span class="o">.</span><span class="n">add_distances_to_target</span><span class="p">(</span><span class="nb nb-Type">float</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>

<span class="k">func</span><span class="w"> </span><span class="n">set_action</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
<span class="w">    </span><span class="n">current_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action</span>

<span class="k">func</span><span class="w"> </span><span class="n">reset</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="p">):</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>
<span class="w">    </span><span class="n">current_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_global_translation</span><span class="p">(</span><span class="nb nb-Type">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>

<span class="k">func</span><span class="w"> </span><span class="n">move_body</span><span class="p">():</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_RIGHT</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_LEFT</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_UP</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_DOWN</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span><span class="p">:</span>
<span class="w">        </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="o">.</span><span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">UP</span><span class="p">)</span>

<span class="k">func</span><span class="w"> </span><span class="n">_ready</span><span class="p">():</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_axis_lock</span><span class="p">(</span><span class="n">PhysicsServer</span><span class="o">.</span><span class="n">BODY_AXIS_LINEAR_Y</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">sensors</span><span class="o">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_node</span><span class="p">(</span><span class="n">target_node_path</span><span class="p">)</span>

<span class="k">func</span><span class="w"> </span><span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
<span class="w">    </span><span class="n">move_body</span><span class="p">()</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-T3JpZ2luYWwgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">extends</span><span class="w"> </span><span class="n">Spatial</span>

<span class="c1"># How fast the agent moves in meters per second.</span>
<span class="k">var</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="c1"># Current velocity of the agent.</span>
<span class="k">var</span><span class="w"> </span><span class="n">velocity</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="k">onready</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">Body</span>

<span class="k">func</span><span class="w"> </span><span class="n">move_body</span><span class="p">():</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_right&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_left&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_up&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_down&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span><span class="p">:</span>
<span class="w">        </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="o">.</span><span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">UP</span><span class="p">)</span>

<span class="k">func</span><span class="w"> </span><span class="n">_ready</span><span class="p">():</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_axis_lock</span><span class="p">(</span><span class="n">PhysicsServer</span><span class="o">.</span><span class="n">BODY_AXIS_LINEAR_Y</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>

<span class="k">func</span><span class="w"> </span><span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
<span class="w">    </span><span class="n">move_body</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>Let’s examine what we changed.</p>
<ol class="arabic">
<li><p>We changed parent class from <code class="docutils literal notranslate"><span class="pre">Spatial</span></code> to <code class="docutils literal notranslate"><span class="pre">RLAgent</span></code>.</p></li>
<li><p>We introduced new variable to set target the agent should find.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">target_node_path</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">NodePath</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>We introduced a variable to store current action.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">var</span><span class="w"> </span><span class="n">current_action</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>We introduced a variable to quickly access our sensors.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">onready</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">sensors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">Sensors</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>We updated <code class="docutils literal notranslate"><span class="pre">_ready</span></code> method to set sensors target.</p>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TW9kaWZpZWQgc2NyaXB0" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tab" tabindex="0">Modified script</button><button aria-controls="panel-1-T3JpZ2luYWwgc2NyaXB0" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tab" tabindex="-1">Original script</button></div><div aria-labelledby="tab-1-TW9kaWZpZWQgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">_ready</span><span class="p">():</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_axis_lock</span><span class="p">(</span><span class="n">PhysicsServer</span><span class="o">.</span><span class="n">BODY_AXIS_LINEAR_Y</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">sensors</span><span class="o">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_node</span><span class="p">(</span><span class="n">target_node_path</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-T3JpZ2luYWwgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">_ready</span><span class="p">():</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_axis_lock</span><span class="p">(</span><span class="n">PhysicsServer</span><span class="o">.</span><span class="n">BODY_AXIS_LINEAR_Y</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div></blockquote>
</li>
<li><p>We updated <code class="docutils literal notranslate"><span class="pre">move_body</span></code> method to manupalate <code class="docutils literal notranslate"><span class="pre">Body</span></code> with actions instead of keyboard.</p>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-TW9kaWZpZWQgc2NyaXB0" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tab" tabindex="0">Modified script</button><button aria-controls="panel-2-T3JpZ2luYWwgc2NyaXB0" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tab" tabindex="-1">Original script</button></div><div aria-labelledby="tab-2-TW9kaWZpZWQgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-TW9kaWZpZWQgc2NyaXB0" name="TW9kaWZpZWQgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">move_body</span><span class="p">():</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_RIGHT</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_LEFT</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_UP</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">current_action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="c1"># MOVE_DOWN</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span><span class="p">:</span>
<span class="w">        </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="o">.</span><span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">UP</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-T3JpZ2luYWwgc2NyaXB0" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-T3JpZ2luYWwgc2NyaXB0" name="T3JpZ2luYWwgc2NyaXB0" role="tabpanel" tabindex="0"><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">move_body</span><span class="p">():</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_right&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_left&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_up&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s2">&quot;ui_down&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span><span class="p">:</span>
<span class="w">        </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">speed</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="o">.</span><span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">UP</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div></blockquote>
</li>
</ol>
<p>7. <code class="docutils literal notranslate"><span class="pre">RLAgent</span></code> class have optional method <code class="docutils literal notranslate"><span class="pre">reset</span></code> to reset world that does nothing be default.
We override the method to reset current action and locate out agent in initial position.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">reset</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="p">):</span>
<span class="w">    </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Vector3</span><span class="o">.</span><span class="n">ZERO</span>
<span class="w">    </span><span class="n">current_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">body</span><span class="o">.</span><span class="n">set_global_translation</span><span class="p">(</span><span class="nb nb-Type">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p>8. By default, <code class="docutils literal notranslate"><span class="pre">RLAgent.get_data</span></code> method raise an error, since no data to return is specified.
Here, we override it to set <code class="docutils literal notranslate"><span class="pre">storage.distances_to_obstacle</span></code> and <code class="docutils literal notranslate"><span class="pre">storage.distances_to_target</span></code> fields with corresponding values from added sensors.
<code class="docutils literal notranslate"><span class="pre">storage</span></code> is a <code class="docutils literal notranslate"><span class="pre">agent_data</span></code> in protobuf message we have defined earlier.
In case you define various possible observations but you want to experiment with particular ones,
you can define logic of the storage filling with help of observation keys in <code class="docutils literal notranslate"><span class="pre">observation_request</span></code>.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">get_data</span><span class="p">(</span><span class="n">_observation_request</span><span class="p">,</span><span class="w"> </span><span class="n">storage</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="p">:</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensors</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;distances_to_obstacle&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="n">storage</span><span class="o">.</span><span class="n">add_distances_to_obstacle</span><span class="p">(</span><span class="nb nb-Type">float</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;distances_to_target&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="n">storage</span><span class="o">.</span><span class="n">add_distances_to_target</span><span class="p">(</span><span class="nb nb-Type">float</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p>9. By default, <code class="docutils literal notranslate"><span class="pre">RLAgent.get_data</span></code> method raise an error, since no action to perform is specified.
Here we override it to assign action value to the introduced variable <code class="docutils literal notranslate"><span class="pre">current_action</span></code>. You can have more complex actions and corresponding logic in the method.</p>
<blockquote>
<div><div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="k">func</span><span class="w"> </span><span class="n">set_action</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
<span class="w">        </span><span class="n">current_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action</span>
</pre></div>
</div>
</div></blockquote>
<p>Thats’s it for <code class="docutils literal notranslate"><span class="pre">Agent</span></code>! Let’s summarize:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RLAgent</span></code> must have <code class="docutils literal notranslate"><span class="pre">get_data</span></code> and <code class="docutils literal notranslate"><span class="pre">set_action</span></code> methods implemented.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RLAgent</span></code> can have <code class="docutils literal notranslate"><span class="pre">reset</span></code> method implemented.</p></li>
</ol>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="world.html" class="btn btn-neutral float-left" title="Creating World" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="environment.html" class="btn btn-neutral float-right" title="Creating Environment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ChernyakKonstantin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>